# ShardingSphere 分库分表

## 分库分表概述

### 什么是分库分表

1. 垂直分库：根据业务逻辑来分库，如订单库只存订单相关的表，商品库只存商品相关的表，能提示数据库性能，但是不能解决单表过大的问题。
2. 水平分库：将相同表结构的表，按照一定的规则拆分到不同库中，每个库可以位于不同的服务器，以实现水平拓展。
3. 垂直分表：将字段比较多的表，拆分成多个表，比如将字段较多或者不频繁访问的字段拆分出来，创建一个拓展表，这样可以减小核心表的大小，减少磁盘IO。
4. 水平分表：将大数量的表，按一定的规则拆分成结构完全相同的表，然后每个表都存一部分数据，从达到减少单表的数量两，提高查询效率。

对于实际业务而言，我们比较推崇的做法就是：垂直分库和水平分表。


### 分库分库带来的问题

1. 分库会造成事务一致性问题，需要而外考虑分布式事务问题。

2. 跨节点关联表问题，如果分库分表后，数据分布在不同的服务器上，无法进行联表查询（解决思路：将联表拆分查询，然后再将结果合并）。
   
3. 跨节点多库查询需要考虑分页和排序问题，增加系统复杂性，需要先在每个节点查询排序返回后，再次将不同节点返回的结果进行排序汇总。

4. 公共表联合查询问题，对一些数量表少的不需要进行分库分表，如字典表、参数配置表，如果需要进行表联合查询时，解决方式是每个库都要都存一份（通过定时任务或消息队列保持全局表数据一致，或者强制所有对公共表的操作都同时发送到所有分库执行）。


## 分库分表的核心概念

- 数据节点：数据分片的最小单元，由数据源名称和数据表组成。
- 逻辑表：同一个表结构的所有水平拆分的所有水平表，我们可以总称为一张逻辑表，在程序中我们只需要创建一个实体类对象。
- 真实表：在分片的数据库中真实存在的物理表。
- 绑定表：分片规则一致的主表和子表。
- 广播表（也称公共表）：在所有的分库中都存在的表，并且它们的表结构和表中的数据在每个数据库中都完全一致，例如字典表。
- 分片键：将数据库(表)进行水平拆分的关键字段，即分库分表是根据那些字段去路由找到对应库和表的。
- 分片算法：通过分片算法将数据进行分片，支持通过 =、BETWEEN 和 IN 分片，算法需要由应用开发者自行实现，可实现的灵活度非常高。
- 分片策略：真正用于进行分片操作的是分片键 + 分片算法，也就是分片策略。


## 常见分片策略

1. 范围切分：如按 ID 的范围拆分，ID 在[1到1千万]的放在第一个库，ID 在[1千万到2千万]放在第二个库，以此类推。该策略的缺点比较明显所有的写都在最后一个库上，读流量也可以能偏移，因为最近增加的数据可能被查询最多。
2. 



## ShardingJdbc 实现分库分表简单配置说明

```


```